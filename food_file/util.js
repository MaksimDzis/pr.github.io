//------------------------------------------------

//------------------------------------------------
function Extend(child,parent){
  var f                       = function(){};
  f.prototype                 = parent.prototype;
  child.prototype             = new f();
  child.prototype.constructor = child;
  child.superclass            = parent.prototype;
}
//------------------------------------------------
function TObject (ca,el,cn) {
  this.caption           = ca;
  this.element           = document.createElement(el);
  this.element.className = cn;
  this.members           = [];
  this.id                = '';
}
//-------------------------------------------------------
//---------------------- СВОЙСТВА -----------------------
// ВАЖНО! Свойства потомков заменят войства родителей.
//        Благодаря этой особенности потомки приобретают
//        свойственную только им функциональность.
//-------------------------------------------------------
TObject.prototype.Top = function (v) {
  if(arguments.length == 1)
    this.element.style.top = v;
  else
    return this.element.style.top;
}
//---
TObject.prototype.Left = function (v) {
  if(arguments.length == 1)
    this.element.style.left = v;
  else
    return this.element.style.left;
}
//---
TObject.prototype.Width = function (v) {
  if(arguments.length == 1)
    this.element.style.width = v;
  else
    return this.element.style.width;
}
//---
TObject.prototype.Height = function (v) {
  if(arguments.length == 1)
    this.element.style.height = v;
  else
    return this.element.style.height;
}
//---
TObject.prototype.Caption = function(v) {
  if(arguments.length == 1)
    this.caption = v;
  else
    return this.caption;
}
//---
TObject.prototype.Build = function (owner,id) {
  //Присвоить id
  this.id = this.element.className + id;
  this.element.id = this.id;
  owner.appendChild(this.element);
}
//---
TObject.prototype.Border = function(v) {
  if(arguments.length == 1)
    this.element.style.border = v;
  else
    return this.element.style.border;
}
//-------------------------------------------------------
//---------------------- СОБЫТИЯ ------------------------
// ВАЖНО! События потомков заменят события родителей.
//        Благодаря этой особенности потомки приобретают
//        свойственную только им функциональность.
//-------------------------------------------------------
// onclick for all, except:
// base, bdo, br, head, html, iframe, meta, param, script, style, title
TObject.prototype.OnClick = function (v) {
  if(arguments.length == 1)
    this.element.onclick = v;
  else
    return this.element.onclick;
}
//---
// ondblclick for all, except:
// base, bdo, br, head, html, iframe, meta, param, script, style, title
TObject.prototype.OnDblClick = function (v) {
  if(arguments.length == 1)
    this.element.ondblclick = v;
  else
    return this.element.ondblclick;
}
//---
// onmousedown for all, except:
// base, bdo, br, head, html, iframe, meta, param, script, style, title
TObject.prototype.OnMouseDown = function (v) {
  if(arguments.length == 1)
    this.element.onmousedown = v;
  else
    return this.element.onmousedown;
}
//---
// onmousemove for all, except:
// base, bdo, br, head, html, iframe, meta, param, script, style, title
TObject.prototype.OnMouseMove = function (v) {
  if(arguments.length == 1)
    this.element.onmousemove = v;
  else
    return this.element.onmousemove;
}
//---
// onmouseover for all, except:
// base, bdo, br, head, html, iframe, meta, param, script, style, title
TObject.prototype.OnMouseOver = function (v) {
  if(arguments.length == 1)
    this.element.onmouseover = v;
  else
    return this.element.onmouseover;
}
//---
// onmouseout for all, except:
// base, bdo, br, head, html, iframe, meta, param, script, style, title
TObject.prototype.OnMouseOut = function (v) {
  if(arguments.length == 1)
    this.element.onmouseout = v;
  else
    return this.element.onmouseout;
}
//---
// onmouseup for all, except:
// base, bdo, br, head, html, iframe, meta, param, script, style, title
TObject.prototype.OnMouseUp = function (v) {
  if(arguments.length == 1)
    this.element.onmouseup = v;
  else
    return this.element.onmouseup;
}
//---
// onkeydown for all, except:
// base, bdo, br, head, html, iframe, meta, param, script, style, title
TObject.prototype.OnKeyDown = function (v) {
  if(arguments.length == 1)
    this.element.onkeydown = v;
  else
    return this.element.onkeydown;
}
//---
// onkeypress for all, except:
// base, bdo, br, head, html, iframe, meta, param, script, style, title
TObject.prototype.OnKeyPress = function (v) {
  if(arguments.length == 1)
    this.element.onkeypress = v;
  else
    return this.element.onkeypress;
}
//---
// onkeyup for all, except:
// base, bdo, br, head, html, iframe, meta, param, script, style, title
TObject.prototype.OnKeyUp = function (v) {
  if(arguments.length == 1)
    this.element.onkeyup = v;
  else
    return this.element.onkeyup;
}
//---
// onload for:
// body, frame, frameset, iframe, img, input type="image", link, script, style
TObject.prototype.OnLoad = function (v) {
  if(arguments.length == 1)
    this.element.onload = v;
  else
    return this.element.onload;
}
//---
// onresize for:
// a, address, b, big, blockquote, body, button, cite, code, dd, dfn, div, dl
// dt, em, fieldset, form, frame, h1 to h6, hr, i, img, input, kbd, label
// legend, li, object, ol, p, pre, samp, select, small, span, strong, sub
// sup, table, textarea, tt, ul, var
TObject.prototype.OnResize = function (v) {
  if(arguments.length == 1)
    this.element.onresize = v;
  else
    return this.element.onresize;
}
//---
// onscroll for:
TObject.prototype.OnScroll = function (v) {
  if(arguments.length == 1)
    this.element.onscroll = v;
  else
    return this.element.onscroll;
}
//---
// onunload for:
// body, frameset
TObject.prototype.OnUnload = function (v) {
  if(arguments.length == 1)
    this.element.onunload = v;
  else
    return this.element.onunload;
}
//---
// onchange for:
// input, select, textarea
TObject.prototype.OnChange = function (v) {
  if(arguments.length == 1)
    this.element.onchange = v;
  else
    return this.element.onchange;
}
//---
// onfocus for all, except:
// base, bdo, br, head, html, iframe, meta, param, script, style, title
TObject.prototype.OnFocus = function (v) {
  if(arguments.length == 1)
    this.element.onfocus = v;
  else
    return this.element.onfocus;
}
//---
// onselect for all, except:
// input type="file", input type="password", input type="text", keygen, textarea
TObject.prototype.OnSelect = function (v) {
  if(arguments.length == 1)
    this.element.onselect = v;
  else
    return this.element.onselect;
}
//---

//------------------------------------------------
function TForm () {//Контейнер
  TForm.superclass.constructor.call(this,'Form','div','form');
  document.title         = this.caption;
}
//---
Extend(TForm,TObject);
//---
//TForm.prototype.foo = function () {}
//---
TForm.prototype.AddComponent = function (v) {
  this.members.push(v);
}
//---
TForm.prototype.Caption = function(v) {
  this.caption   = v;
  document.title = this.caption;
}
//---
TForm.prototype.Build = function () {
  var id = 1;
  //
  this.id = this.element.className + id;
  this.element.id = this.id;
  
  document.body.appendChild(this.element);
  for(var i in this.members)
    this.members[i].Build(this.element,++id);
}
//---

//------------------------------------------------
function TPanel () {//Контейнер
  TPanel.superclass.constructor.call(this,'Panel','div','panel');
}
//---
Extend(TPanel,TObject);
//---
//TPanel.prototype.foo = function () {}
//---
TPanel.prototype.AddComponent = function (v) {
  this.members.push(v);
}
//---
TPanel.prototype.Build = function (owner,id) {
  this.id = this.element.className + id;
  this.element.id = this.id;
  owner.appendChild(this.element);
  for(var i in this.members)
    this.members[i].Build(this.element,++id);
}
//---
TPanel.prototype.Caption = function (v) {
  //this.members.push(v);
  this.element.innerHTML = v;
}
//------------------------------------------------
function TButton () {
  TButton.superclass.constructor.call(this,'Button','button','button');
}
//---
Extend(TButton,TObject);
//---
//TButton.prototype.foo = function () {}
//---
TButton.prototype.Caption = function (v) {
  this.caption           = v;
  this.element.innerHTML = this.caption;
}
//---

//------------------------------------------------
function TPaintBox () {
  TPaintBox.superclass.constructor.call(this,'PaintBox','canvas','paintbox');
  this.canvas                = this.element.getContext('2d');
  this.element.style.top     = '5px';
  this.element.style.left    = '5px';
  this.element.style.width   = '200px';
  this.element.style.height  = '200px';
}
//---
Extend(TPaintBox,TObject);
//---
//TPaintBox.prototype.foo = function () {}
//---
TPaintBox.prototype.CanvasWidth = function (w) {
  var c = document.getElementById(this.id);
  c.width = w;
  this.canvas.width = w;
}
//---
TPaintBox.prototype.CanvasHeight = function (h) {
  var c = document.getElementById(this.id);
  c.height = h;
  this.canvas.height = h;
}
//---
TPaintBox.prototype.Canvas = function () {
  return this.element.getContext('2d');
}
//------------------------------------------------
function TChart () {
  TChart.superclass.constructor.call(this,'Chart','canvas','chart');
  this.ctx                   = this.element.getContext('2d');
  this.element.style.top     = '5px';
  this.element.style.left    = '5px';
  this.element.style.width   = '200px';
  this.element.style.height  = '200px';
  //---
  this.el     = 0.5;
  this.px     = 10.0;//число пикселей на единицу вспомогательной сетки
  this.base   = 4.0;//число единиц вспомогательной сетки на единицу основной
  this.lbas   = 5.0;//длина засечек
  //область диаграммы
  this.chax   = 0.0;
  this.chay   = 0.0;
  this.chaw   = this.ctx.width;
  this.chah   = this.ctx.height;
  this.chaf   = 'rgb(239,228,176)';
  //область построения диаграммы
  this.plaxy  = 15.0;//
  this.plalb  = 90.0;
  this.plaw   = this.chaw - (this.plalb + this.plaxy);//должно быть четным
  this.plah   = this.chah - (this.plalb + this.plaxy);//должно быть четным
  this.plaf   = 'rgb(255,255,255)';
  //область перерисовки графиков
  this.clipx  = this.plaxy + 2.0*this.el;
  this.clipy  = this.plaxy +     this.el;
  this.clipw  = this.plaw  - 4.0*this.el;
  this.cliph  = this.plah  - 3.0*this.el;  
  //целочисленные координаты нуля графика
  this.cx     = this.plaxy + 0.5*this.plaw;
  this.cy     = this.plaxy + 0.5*this.plah;
  //физические характеристики области построения
  this.scaily = 1.0;//0.125;//0.25;//0.5;//0.15625;
  this.scailx = 1.0;//0.125;//0.25;//0.5;//0.15625;
  this.cntrx  = 0.0;
  this.cntry  = 0.0;  
  this.minx   = 0.0;
  this.maxx   = 0.0;
  this.miny   = 0.0;
  this.maxy   = 0.0;
  this.xstart = 0.0;
  this.ystart = 0.0;
  this.cxold  = 0.0;
  this.cyold  = 0.0;
  this.xcurr  = 0.0;
  this.ycurr  = 0.0;
  this.ok     = false;  
  this.CalcMinMax();
  //---
  this.ode    = null;
  //---
}
//---
Extend(TChart,TObject);
//---
//TChart.prototype.foo = function () {}
//---
TChart.prototype.ChartWidth = function (w) {
  var c = document.getElementById(this.id);
  c.width = w;
  this.ctx.width = w;
  this.SetProp();
}
//---
TChart.prototype.ChartHeight = function (h) {
  var c = document.getElementById(this.id);
  c.height = h;
  this.ctx.height = h;
  this.SetProp();
}
//---
TChart.prototype.Text = function (txt,x,y,cl) {
  this.ctx.font = '12px Courier';
  this.ctx.textAlign = 'left';
  this.ctx.fillStyle = cl;
  this.ctx.fillText(txt,x,y);
}
//---
TChart.prototype.PrintInfo = function () {
  var txt, v, cl = 'black', y = 12, j;
  //---
  this.ctx.fillStyle = this.chaf;
  this.ctx.fillRect(1,1,this.plaw-1,this.plaxy-1);
  //---
  j = this.px*this.base;
  v = this.scailx*(this.xcurr - this.cx)/j;
  txt  = 'X = ' + (v).toExponential(2) + ';';
  this.Text(txt,20,y,cl);
  //---
  v = -this.scaily*(this.ycurr - this.cy)/j;
  txt  = 'Y = ' + (v).toExponential(2) + ';';
  this.Text(txt,130,y,cl);
  //---
  txt  = 'Scail X = ' + (this.scailx).toExponential(2) + ';';
  this.Text(txt,230,y,cl);
  //---
  txt  = 'Scail Y = ' + (this.scaily).toExponential(2) + ';';
  this.Text(txt,380,y,cl);
}
//---
TChart.prototype.Tro = function (angle,cx,cy) {
  this.ctx.translate(cx,cy);
  this.ctx.rotate(angle*Math.PI/180.0);
  this.ctx.translate(-cx,-cy);
}
//---
TChart.prototype.SetScailXY = function (sx,sy) {
  this.scailx = sx;
  this.scaily = sy;
  this.CalcMinMax();
}
//---
TChart.prototype.CalcMinMax = function () {
  this.minx   = this.cntrx - this.scailx*(this.cx-this.plaxy)/(this.px*this.base);
  this.maxx   = this.cntrx + this.scailx*(this.plaxy + this.plaw - this.cx)/(this.px*this.base);
  this.miny   = this.cntry - this.scaily*(this.plaxy + this.plah - this.cy)/(this.px*this.base);
  this.maxy   = this.cntry + this.scaily*(this.cy-this.plaxy)/(this.px*this.base);
}
//---
TChart.prototype.SetProp = function () {
  this.chaw = this.ctx.width;
  this.chah = this.ctx.height;
  //
  this.plaw = this.chaw - (this.plalb + this.plaxy);
  this.plah = this.chah - (this.plalb + this.plaxy);
  //
  this.clipx  = this.plaxy + 2.0*this.el;
  this.clipy  = this.plaxy +     this.el;
  this.clipw  = this.plaw  - 4.0*this.el;
  this.cliph  = this.plah  - 3.0*this.el;  
  //
  this.cx     = this.plaxy + 0.5*this.plaw;
  this.cy     = this.plaxy + 0.5*this.plah;
}
//---
TChart.prototype.Project = function (x,xmin,xmax,ymin,ymax){
  return (ymin + (x - xmin)*(ymax - ymin)/(xmax - xmin));
}
//---
TChart.prototype.Draw = function () {
  this.CalcMinMax();
  //заливка области диаграммы
  this.FillChartArea();
  this.FillPlotArea();
  this.DrawGrig();
  
  //this.AddCurve(3,2.25,'rgba(0,0,255,1.0)');
  if(this.ode) this.DrawVector();
  this.AddCurve(2,0.25,'rgba(255,0,0,1.0)');
  this.DrawScale();
  this.PrintInfo();
  //
}
//---
TChart.prototype.SetODE = function (ode) {
  this.ode = ode;
}
//--- Функция, которая отображает поле направлений для 
//--- сисемы обыкновенных дифференциальных уравнений
TChart.prototype.DrawVector = function () {
  this.ctx.save();
  this.ClipPlotArea();
  
  var X  = Math.ceil(this.plaw/this.px),
	  Y  = Math.ceil(this.plah/this.px);
	  
  var xa = this.scailx/this.base;
  var ya = this.scaily/this.base;
  
  var zx = -xa*Math.floor((this.cx - this.plaxy)/this.px),
      zy =  ya*Math.floor((this.cy - this.plaxy)/this.px);

  var V = [], F = [], T = 0.0;
  var dydx, dxdy, r = this.px;
  
  for (var y=0;y<Y;y++){
    for (var x=0;x<X;x++){
	  
	  V[0] = zx + x*xa;
	  V[1] = zy - y*ya;

	  this.ode.System(T,V,F);

      x0 = this.Project(V[0],this.minx,this.maxx,this.plaxy,this.plaxy+this.plaw);
      y0 = this.Project(V[1],this.miny,this.maxy,this.plaxy+this.plah,this.plaxy);
  
	  if(F[0] != 0.0){
	    dydx = F[1] / F[0];
	    x1 = x0 + r * Sign(F[0])/Math.sqrt(1.0 + dydx * dydx);
	  } else {
	    x1 = x0 + r * Sign(F[0]);
	    y1 = y0;
	  }

	  if(F[1] != 0.0){
	    dxdy = F[0] / F[1];
	    y1 = y0 - r * Sign(F[1])/Math.sqrt(1.0 + dxdy * dxdy);
	  } else {
	    y1 = y0 - r * Sign(F[1]);
	    x1 = x0;
	  }
	  
      this.ctx.beginPath();
	  var grd = this.ctx.createLinearGradient(x0,y0,x1,y1);
      grd.addColorStop(0,'blue');
      grd.addColorStop(1,'white');
	  this.ctx.strokeStyle = grd;
      this.ctx.lineWidth   = 1;
      this.ctx.moveTo(x0,y0);
      this.ctx.lineTo(x1,y1);
      this.ctx.stroke();	
    }
  }
  this.ctx.restore();
}
//---
TChart.prototype.AddCurve = function (X,Y,color) {
  this.ctx.save();
  this.ClipPlotArea();
  var  x,
       y;
  var _X  = [],
      _Y  = [],
	   t  = -50.0,
	   ts = 0.1;
  for(var i=0;i<1000;i++){
    _X.push(t);
	_Y.push(X*Math.sin(1.2 * t) + 3*Math.cos(Y * t));
	//_Y.push(t*t/50);
	t += ts;
  }
  
  this.ctx.beginPath();            
  this.ctx.lineWidth   = 2;
  this.ctx.strokeStyle = color;//'black';
  this.ctx.lineCap     = 'butt';//'square';//'round';//
  this.ctx.lineJoin    = 'round';//'miter';//'bevel';//
  //this.ctx.miterLimit  = 50;
  x = this.Project(_X[0],this.minx,this.maxx,this.plaxy,this.plaxy+this.plaw);
  y = this.Project(_Y[0],this.miny,this.maxy,this.plaxy+this.plah,this.plaxy);
  this.ctx.moveTo(x,y);
  for(var i=1;i<1000;i++){
    x = this.Project(_X[i],this.minx,this.maxx,this.plaxy,this.plaxy+this.plaw);
    y = this.Project(_Y[i],this.miny,this.maxy,this.plaxy+this.plah,this.plaxy);
    this.ctx.lineTo(x,y);
  }
  this.ctx.stroke();
  this.ctx.restore();
}
//--- Заливка области диаграммы
TChart.prototype.FillChartArea = function () {
  // заливка области диаграммы
  this.ctx.fillStyle   = this.chaf;
  this.ctx.rect(this.chax,this.chay,this.chaw,this.chah);
  this.ctx.fill();
}
//--- Заливка области построения диаграммы
TChart.prototype.FillPlotArea = function () {
  this.ctx.beginPath();
  this.ctx.rect(this.plaxy + this.el,  this.plaxy + this.el,
		        this.plaw  - 2*this.el,this.plah  - 2*this.el);

  this.ctx.lineWidth   = 1;
  this.ctx.strokeStyle = 'black';
  this.ctx.stroke();
  this.ctx.closePath();
  
  this.ctx.fillStyle = this.plaf;
  this.ctx.fillRect(this.plaxy + 2.0*this.el,this.plaxy + 2.0*this.el,
		            this.plaw  - 4.0*this.el,this.plah  - 4.0*this.el);
}
//--- Вырезает ту часть области построения диаграммы
//--- в которой непосредственно должна происходить
//--- перерисовка
TChart.prototype.ClipPlotArea = function () {
  //
  this.ctx.beginPath();
  this.ctx.rect(this.clipx,this.clipy,this.clipw,this.cliph);
  this.ctx.clip();
  this.ctx.closePath();
}
//--- Отрисовывает вспомогательные, основные, нулевые
//--- линии сетки и засечки
TChart.prototype.DrawGrig = function () {
  // 
  this.ctx.save();
  this.ClipPlotArea();
  //вспомогательные переменные
  var i, j, cl;
  //вспомогательные линии сетки
  cl = 'rgb(200,200,200)';
    //вертикальные 
  i = this.cx - this.px*Math.floor((this.cx - this.plaxy)/this.px);
  while(i <= (this.plaxy + this.plaw)){
    this.ctx.beginPath();            
      this.ctx.lineWidth   = 1.0;
      this.ctx.strokeStyle = cl;  
      this.ctx.moveTo(i,this.plaxy);
      this.ctx.lineTo(i,this.plaxy + this.plah);
    this.ctx.stroke();
    i += this.px;
  }
    //горизонтальные
  i = this.cy - this.px*Math.floor((this.cy - this.plaxy)/this.px);
  while(i <= (this.plaxy + this.plah)){
    this.ctx.beginPath();            
      this.ctx.lineWidth   = 1.0;
      this.ctx.strokeStyle = cl;  
      this.ctx.moveTo(this.plaxy            ,i);
      this.ctx.lineTo(this.plaxy + this.plaw,i);
    this.ctx.stroke();
    i += this.px;
  }
  //основные линии сетки
  cl = 'rgb(150,150,150)';
    //вертикальные
  j = this.px*this.base;
  i = this.cx - j*Math.floor((this.cx - this.plaxy)/j);
  while(i <= (this.plaxy + this.plaw)){
    this.ctx.beginPath();            
      this.ctx.lineWidth   = 1.0;
      this.ctx.strokeStyle = cl;  
      this.ctx.moveTo(i,this.plaxy);
      this.ctx.lineTo(i,this.plaxy + this.plah);
    this.ctx.stroke();
    i += j;
  }
    //горизонтальные
  j = this.px*this.base;
  i = this.cy - j*Math.floor((this.cy - this.plaxy)/j);
  while(i <= (this.plaxy + this.plah)){
    this.ctx.beginPath();            
      this.ctx.lineWidth   = 1.0;
      this.ctx.strokeStyle = cl;  
      this.ctx.moveTo(this.plaxy            ,i);
      this.ctx.lineTo(this.plaxy + this.plaw,i);
    this.ctx.stroke();
    i += j;
  }
  //перекрестие
  cl = 'rgb(0,0,0)';
    //вертикальные
  i = this.cx;
  if(i >= this.plaxy && i <= (this.plaxy + this.plaw)){
    this.ctx.beginPath();            
      this.ctx.lineWidth   = 1.0;
      this.ctx.strokeStyle = cl;  
      this.ctx.moveTo(i,this.plaxy);
      this.ctx.lineTo(i,this.plaxy + this.plah);
    this.ctx.stroke();
  }
    //горизонтальные
  i = this.cy;
  if(i >= this.plaxy && i <= (this.plaxy + this.plah)){
    this.ctx.beginPath();
      this.ctx.lineWidth   = 1.0;
      this.ctx.strokeStyle = cl;  
      this.ctx.moveTo(this.plaxy            ,i);
      this.ctx.lineTo(this.plaxy + this.plaw,i);
    this.ctx.stroke();
  }
  //засечки
  cl = 'rgb(0,0,0)';
    //вертикальные
  j = this.px*this.base;
  i = this.cx - j*Math.floor((this.cx - this.plaxy)/j);
  while(i <= (this.plaxy + this.plaw)){
    this.ctx.beginPath();            
      this.ctx.lineWidth   = 1.0;
      this.ctx.strokeStyle = cl;  
      this.ctx.moveTo(i,this.plaxy);
      this.ctx.lineTo(i,this.plaxy + this.lbas);
      this.ctx.moveTo(i,this.plaxy + this.plah);
      this.ctx.lineTo(i,this.plaxy + this.plah - this.lbas);
    this.ctx.stroke();
    i += j;
  }
    //горизонтальные
  j = this.px*this.base;
  i = this.cy - j*Math.floor((this.cy - this.plaxy)/j);
  while(i <= (this.plaxy + this.plah)){
    this.ctx.beginPath();            
      this.ctx.lineWidth   = 1.0;
      this.ctx.strokeStyle = cl;  
      this.ctx.moveTo(this.plaxy            ,i);
      this.ctx.lineTo(this.plaxy + this.lbas,i);
      this.ctx.moveTo(this.plaxy + this.plaw,i);
      this.ctx.lineTo(this.plaxy + this.plaw - this.lbas,i);
    this.ctx.stroke();
    i += j;
  }
  //
  this.ctx.restore();
  //
}
//---
TChart.prototype.DrawScale = function () {
  //вспомогательные переменные
  var i, j, cl, txt, k, a = 0.0, x, y;
  // 
  cl = 'rgb(0,0,0)';
    //вертикальные
  j = this.px*this.base;
  k = Math.floor((this.cx - this.plaxy)/j);
  i = this.cx - j*k;
  a = -this.scailx*k;
  y = this.plaxy + this.plah;
  while(i <= (this.plaxy + this.plaw)){
    this.ctx.beginPath();            
      this.ctx.lineWidth   = 1.0;
      this.ctx.strokeStyle = cl;  
      this.ctx.moveTo(i,y);
      this.ctx.lineTo(i,y + this.lbas);
    this.ctx.stroke();
    x = i-4; 
    this.Tro(90.0,x,y+7);
    txt = (a).toExponential(2);
    this.Text(txt,x,y+7,cl);
    this.Tro(-90.0,x,y+7);
    i += j;
	a += this.scailx;
  }
    //горизонтальные
  j = this.px*this.base;
  k = Math.floor((this.cy - this.plaxy)/j);
  i = this.cy - j*k;
  a = this.scaily*k;
  x = this.plaxy + this.plaw;
  while(i <= (this.plaxy + this.plah)){
    this.ctx.beginPath();            
      this.ctx.lineWidth   = 1.0;
      this.ctx.strokeStyle = cl;  
      this.ctx.moveTo(x,i);
      this.ctx.lineTo(x + this.lbas,i);
    this.ctx.stroke();
    txt = (a).toExponential(2);
    this.Text(txt,x+7,i+4,cl);
    i += j;
	a -= this.scaily;
  }
  //
}
//---
TChart.prototype.OnDown = function (e) {
  this.xstart = e.pageX - this.element.offsetLeft;
  this.ystart = e.pageY - this.element.offsetTop;
  this.cxold  = this.cx;
  this.cyold  = this.cy;
  if(this.xstart >= this.plaxy && this.xstart <= (this.plaxy + this.plaw) && 
     this.ystart >= this.plaxy && this.ystart <= (this.plaxy + this.plah))
    this.ok = true;
}
//---
TChart.prototype.OnUp = function (e) {
  this.ok = false;
}
//---
TChart.prototype.OnMove = function (e) {
  this.xcurr = e.pageX - this.element.offsetLeft;
  this.ycurr = e.pageY - this.element.offsetTop;
  if(this.ok){
    this.PrintInfo();
    this.cx = this.cxold - (this.xstart - this.xcurr);
    this.cy = this.cyold - (this.ystart - this.ycurr);
    this.Draw();
  }
  this.element.style.cursor = 'pointer';//'crosshair';
}
//------------------------------------------------
function TMemo () {
  TMemo.superclass.constructor.call(this,'Memo','textarea','memo');
}
//---
Extend(TMemo,TObject);
//---
//TMemo.prototype.foo = function () {}
//---
TMemo.prototype.Text = function (v) {
  if(arguments.length == 1)
    this.element.value = v;
  else
    return this.element.value;
}
//---

//------------------------------------------------
function TEdit () {
  TEdit.superclass.constructor.call(this,'Edit','input','edit');
  this.element.type = 'text';
}
//---
Extend(TEdit,TObject);
//---
//TEdit.prototype.foo = function () {}
//---
TEdit.prototype.Text = function (v) {
  if(arguments.length == 1)
    this.element.value = v;
  else
    return this.element.value;
}
//---

//------------------------------------------------
function TTrackBar () {
  TTrackBar.superclass.constructor.call(this,'TrackBar','input','trackbar');
  this.element.type = 'range';
}
//---
Extend(TTrackBar,TObject);
//---
//TTrackBar.prototype.foo = function () {}
//---
TTrackBar.prototype.Position = function (v) {
  if(arguments.length == 1)
    this.element.value = v;
  else
    return this.element.value;
}
//---
TTrackBar.prototype.Min = function (v) {
  if(arguments.length == 1)
    this.element.min = v;
  else
    return this.element.min;
}
//---
TTrackBar.prototype.Max = function (v) {
  if(arguments.length == 1)
    this.element.max = v;
  else
    return this.element.max;
}
//---
TTrackBar.prototype.Frequency = function (v) {
  if(arguments.length == 1)
    this.element.step = v;
  else
    return this.element.step;
}
//---

//------------------------------------------------
function TSpinEdit () {
  TSpinEdit.superclass.constructor.call(this,'SpinEdit','input','spinedit');
  this.element.type = 'number';
}
//---
Extend(TSpinEdit,TObject);
//---
//TSpinEdit.prototype.foo = function () {}
//---
TSpinEdit.prototype.Position = function (v) {
  if(arguments.length == 1)
    this.element.value = v;
  else
    return this.element.value;
}
//---
TSpinEdit.prototype.Min = function (v) {
  if(arguments.length == 1)
    this.element.min = v;
  else
    return this.element.min;
}
//---
TSpinEdit.prototype.Max = function (v) {
  if(arguments.length == 1)
    this.element.max = v;
  else
    return this.element.max;
}
//---
TSpinEdit.prototype.Frequency = function (v) {
  if(arguments.length == 1)
    this.element.step = v;
  else
    return this.element.step;
}
//---

//------------------------------------------------
function TColorDialog () {
  TColorDialog.superclass.constructor.call(this,'ColorDialog','input','colordialog');
  this.element.type = 'color';
}
//---
Extend(TColorDialog,TObject);
//---
//TColorDialog.prototype.foo = function () {}
//---
TColorDialog.prototype.Color = function (v) {
  if(arguments.length == 1)
    this.element.value = v;
  else
    return this.element.value;
}
//---

//------------------------------------------------
function TCheckBox () {
  TCheckBox.superclass.constructor.call(this,'CheckBox','input','checkbox');
  this.element.type = 'checkbox';
}
//---
Extend(TCheckBox,TObject);
//---
//TCheckBox.prototype.foo = function () {}
//---
TCheckBox.prototype.Checked = function (v) {
  if(arguments.length == 1)
    this.element.checked = v;
  else
    return this.element.checked;
}
//---

//------------------------------------------------
function TRadioButton () {
  TRadioButton.superclass.constructor.call(this,'RadioButton','input','radiobutton');
  this.element.type = 'radio';
}
//---
Extend(TRadioButton,TObject);
//---
//TRadioButton.prototype.foo = function () {}
//---
TRadioButton.prototype.Checked = function (v) {
  if(arguments.length == 1)
    this.element.checked = v;
  else
    return this.element.checked;
}
//---

//------------------------------------------------

//------------------------------------------------